@model IEnumerable<Sonatto.Models.Produto>
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Sonatto Catalogo</title>
    <link rel="stylesheet" href="~/css/Index.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/Catalogo.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/Sonatto.styles.css" asp-append-version="true" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bruno+Ace&display=swap" rel="stylesheet">
</head>
<body>
    @Html.Partial("_Header")


    <div class="conteudo-page">

    
        <div class="menuLateral">
            <div class="navDasPag">
                <a asp-area="" asp-controller="Home" asp-action="Index">Home ></a>
                <a asp-area="" asp-controller="Home" asp-action="Index">Produtos ></a>
            </div>

            <div class="menuLateralFiltros">
                <div class="menuLateralFiltrosTitulo">
                    <p>Filtros</p>
                    <img src="~/imgs/definindo-linhas.png" />
                </div>

                <div class="menuLateralFiltrosCategoria">
                    <p>Sopro</p> <p> ></p>
                    <p>Percussão</p> <p> ></p>
                    <p>Corda</p> <p> ></p>
                    <p>Teclas</p> <p> ></p>
                </div>

                <div class="menuLateralFiltrosPrecos">
                    <p>Preços</p>
                    <div class="slider-container">
                        <div class="slider-track"></div>
                        <input type="range" min="0" max="10000" value="0000" id="minRange">
                        <input type="range" min="0" max="10000" value="5200" id="maxRange">
                    </div>
                </div>

                <div class="menuLateralFiltrosPrecosValores">
                    <span id="minValue">R$1.300</span>
                    <span id="maxValue">R$5.200</span>
                </div>

                <script>
                    const minRange = document.getElementById("minRange");
                    const maxRange = document.getElementById("maxRange");
                    const minValue = document.getElementById("minValue");
                    const maxValue = document.getElementById("maxValue");
                    const track = document.querySelector(".slider-track");

                    function updateTrack() {
                        const min = parseInt(minRange.value);
                        const max = parseInt(maxRange.value);

                        if (min > max - 500) minRange.value = max - 500;

                        const minPercent = (minRange.value / 10000) * 100;
                        const maxPercent = (maxRange.value / 10000) * 100;

                        track.style.background = `linear-gradient(to right,
                                            #d9d9d9 ${minPercent}%,
                                            black ${minPercent}%,
                                            black ${maxPercent}%,
                                            #d9d9d9 ${maxPercent}%)`;

                        minValue.textContent = "R$" + min.toLocaleString("pt-BR");
                        maxValue.textContent = "R$" + max.toLocaleString("pt-BR");
                    }

                    minRange.addEventListener("input", updateTrack);
                    maxRange.addEventListener("input", updateTrack);
                    updateTrack();
                </script>


                <div class="menuLateralFiltrosAplicar">
                    <p>Aplicar filtros</p>
                </div>
            </div>
        </div>

        <!-- EXIBIÇÃO DE PRODUTOS -->
        <div class="exibicao">
            <div class="exibicaoFilto">
                <p><span style="color: gray;">Filtro:</span> Maior relevância</p>
            </div>

            <div class="exibicaoGrid">
                @if (Model != null && Model.Any())
                {
                    @foreach (var produto in Model)
                    {
                        <div class="exibicaoCard" data-avaliacao="@produto.Avaliacao.ToString("F1", System.Globalization.CultureInfo.InvariantCulture)">
                            <img src="@produto.UrlImagens[0]" class="exibicaoCardimg" />
                            <p class="cardNome">
                                @(produto.NomeProduto.Length > 25 ? produto.NomeProduto.Substring(0, 25) + "..." : produto.NomeProduto)
                            </p>
                            <div class="cardNotas">
                                <div class="rating-container">
                                    <span class="star"></span>
                                    <span class="star"></span>
                                    <span class="star"></span>
                                    <span class="star"></span>
                                    <span class="star"></span>
                                    <p class="cardNotasNota"><span>@produto.Avaliacao</span>/5</p>
                                </div>
                                <div class="cardPreco">
                                    <strong>R$ @produto.Preco</strong>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <p>Nenhum produto encontrado.</p>
                }
                
            </div>

            <!-- PAGINAÇÃO -->
            <div class="exibicaoSwitch">
                <button class="exibicaoSwitchAnterior"
                        onclick="location.href='@Url.Action("Catalogo", new { pagina = ViewBag.PaginaAtual - 1 })'"
                @(ViewBag.PaginaAtual <= 1 ? "disabled" : "")>
                    <img src="~/imgs/setaEsquerda.png" class="seta" />
                    Ant.
                </button>

                <div class="exibicaoSwitchNumeros">
                    @if (ViewBag.TotalPaginas > 1)
                    {
                        for (int i = 1; i <= ViewBag.TotalPaginas; i++)
                        {
                            <a href="@Url.Action("Catalogo", new { pagina = i })"
                               class="@(i == ViewBag.PaginaAtual ? "ativo" : "")">
                                @i
                            </a>
                        }
                    }
                </div>

                <button class="exibicaoSwitchProximo"
                        onclick="location.href='@Url.Action("Catalogo", new { pagina = ViewBag.PaginaAtual + 1 })'"
                @(ViewBag.PaginaAtual >= ViewBag.TotalPaginas ? "disabled" : "")>
                    Próx. <img src="~/imgs/setaDireita.png" class="seta" />
                </button>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cards = document.querySelectorAll('.exibicaoCard');

            cards.forEach(card => {
                // Lê o valor com ponto (ex: "4.5") → vira número
                const rating = parseFloat(card.getAttribute('data-avaliacao').replace(',', '.')) || 0;
                const stars = card.querySelectorAll('.star');

                stars.forEach((star, index) => {
                    const starValue = index + 1;

                    // Remove classes anteriores
                    star.classList.remove('filled', 'half');

                    if (rating >= starValue) {
                        star.classList.add('filled');
                    } else if (rating >= starValue - 0.5) {
                        star.classList.add('half');
                    }
                });
            });
        });
    </script>
    @Html.Partial("_Footer")
</body>
</html>
