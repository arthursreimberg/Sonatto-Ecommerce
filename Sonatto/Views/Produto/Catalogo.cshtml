@model IEnumerable<Sonatto.Models.Produto>
@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Catálogo - Sonatto</title>
    <link rel="stylesheet" href="~/css/Catalogo.css" />
    <link href="~/imgs/Logos/Monografia.png" rel="shortcut icon" />
</head>
<body>

    @Html.Partial("_Header")

    <div class="conteudo-page">

        <!-- MENU LATERAL -->
        <div class="menuLateral">
            <div class="navDasPag">
                <a asp-controller="Home" asp-action="Index">Home ></a>
                <a asp-controller="Produto" asp-action="Catalogo">Produtos ></a>
            </div>

            <div class="menuLateralFiltros">
                <div class="menuLateralFiltrosTitulo">
                    <p>Filtros</p>
                    <img src="~/imgs/definindo-linhas.png" />
                </div>

                <div class="menuLateralFiltrosCategoria">
                    <p>Sopro</p> <p> ></p>
                    <p>Percussão</p> <p> ></p>
                    <p>Corda</p> <p> ></p>
                    <p>Teclas</p> <p> ></p>
                </div>

                <div class="menuLateralFiltrosPrecos">
                    <p>Preços</p>
                    <div class="slider-container">
                        <form asp-controller="Produto" asp-action="Catalogo" method="post" class="form-inputs">
                            <input type="text" class="valor-input" id="valor-min" placeholder="Val. Min" />
                            <input type="text" class="valor-input" id="valor-max" placeholder="Val. Máx" />
                        </form>
                    </div>
                </div>


                <div class="menuLateralFiltrosAplicar">
                    <p>Aplicar filtros</p>
                </div>
            </div>
        </div>

        <!-- ÁREA DOS PRODUTOS -->
        <div class="exibicao">

            <div class="exibicaoFilto">
                <p><span style="color: gray;">Filtro:</span> Maior relevância</p>
            </div>

            <!-- LISTA DE PRODUTOS -->
            <div class="exibicaoGrid" id="listaProdutos">
                @Html.Partial("_CardsProdutos", Model)
            </div>

            <!-- PAGINAÇÃO -->
            <div class="exibicaoSwitch">

                <button class="exibicaoSwitchAnterior"
                        onclick="location.href='@Url.Action("Catalogo", new { pagina = ViewBag.PaginaAtual - 1, search = ViewBag.Search })'"
                @(ViewBag.PaginaAtual <= 1 ? "disabled" : "")>
                    <img src="~/imgs/setaEsquerda.png" class="seta" /> Ant.
                </button>

                <div class="exibicaoSwitchNumeros">
                    @if (ViewBag.TotalPaginas > 1)
                    {
                        for (int i = 1; i <= ViewBag.TotalPaginas; i++)
                        {
                            <a href="@Url.Action("Catalogo", new { pagina = i, search = ViewBag.Search })"
                               class="@(i == ViewBag.PaginaAtual ? "ativo" : "")">
                                @i
                            </a>
                        }
                    }
                </div>

                <button class="exibicaoSwitchProximo"
                        onclick="location.href='@Url.Action("Catalogo", new { pagina = ViewBag.PaginaAtual + 1, search = ViewBag.Search })'"
                @(ViewBag.PaginaAtual >= ViewBag.TotalPaginas ? "disabled" : "")>
                    Próx. <img src="~/imgs/setaDireita.png" class="seta" />
                </button>

            </div>

        </div>
    </div>

    @Html.Partial("_Footer")

    <!-- BUSCA DINÂMICA -->
    <script>
        const campoBusca = document.getElementById("HeaderBusca");
        const lista = document.getElementById("listaProdutos");

        if (campoBusca) {
            campoBusca.addEventListener("input", function () {
                const valor = campoBusca.value;

                fetch(`/Produto/BuscarProdutos?search=${encodeURIComponent(valor)}`)
                    .then(res => res.text())
                    .then(html => lista.innerHTML = html);
            });
        }
    </script>

    <!-- MANTER VALOR DE BUSCA NO CAMPO AO RECARREGAR -->
    <script>
        window.addEventListener("load", () => {
            const campo = document.getElementById("HeaderBusca");
            const urlParams = new URLSearchParams(window.location.search);

            const busca = urlParams.get("search");

            if (campo && busca) {
                campo.value = busca;
            }
        });
    </script>

    <!--Preenchimento das estrelas-->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cards = document.querySelectorAll('.exibicaoCard');

            cards.forEach(card => {
                // Lê o valor com ponto (ex: "4.5") → vira número
                const rating = parseFloat(card.getAttribute('data-avaliacao').replace(',', '.')) || 0;
                const stars = card.querySelectorAll('.star');

                stars.forEach((star, index) => {
                    const starValue = index + 1;

                    // Remove classes anteriores
                    star.classList.remove('filled', 'half');

                    if (rating >= starValue) {
                        star.classList.add('filled');
                    } else if (rating >= starValue - 0.5) {
                        star.classList.add('half');
                    }
                });
            });
        });
    </script>

</body>
</html>
