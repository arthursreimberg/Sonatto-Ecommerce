@model IEnumerable<Sonatto.Models.Produto>

@{
    Layout = null;

    // Dados de teste para compras (substituir futuramente pelo model real)
    List<string> teste = new List<string>
    {
        "a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a"
    };
}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sonatto</title>

    <link rel="stylesheet" href="~/css/Index.css" />
    <link rel="stylesheet" href="~/css/Perfil.css" />
    <link href="~/imgs/Logos/Monografia.png" rel="shortcut icon" />
</head>

<body>

    @Html.Partial("_Header")

    <!-- Navegação da Página -->
    <div class="navDasPag">
        <a asp-controller="Home" asp-action="Index">Home ></a>
        <a asp-controller="Usuario" asp-action="Perfil" style="color:black;">Perfil ></a>
    </div>

    <!-- Cabeçalho Perfil -->
    <div class="tituloLogOff">
        <h2>Bem vindo(a) de volta, Usuário</h2>

        <div class="logOff">
            <h4>Desconectar</h4>
            <img src="~/imgs/icones/NTrheoXd.png" />
        </div>
    </div>

    <!-- Últimas Compras -->
    <div class="ultimasCompras">

        <div class="tituloBar">
            <h1>Suas últimas compras</h1>
            <img src="~/imgs/icones/seta-cima.svg" alt="Toggle" class="toggle-compras">
        </div>

        <div class="cardsDados">
            @foreach (var compra in teste)
            {
                <div class="cardCompras">
                    <img src="~/imgs/icones/Sacola.svg" />
                    <div class="dadosCard">
                        <p>Data: dd/mm/aaaa</p>
                        <p>Pagamento: X</p>
                        <p>Valor Total: R$ XXXX.xx</p>
                        <p class="maisDetalhes">Clique para ver mais detalhes</p>
                    </div>
                </div>
            }
        </div>

        <!-- Dados completos da compra -->
        <div class="dadosDaCompra">
            <h1>Dados da compra</h1>

            <div class="subCard">

                <h2 class="data">Data: dd/mm/aaaa</h2>

                <div class="grupo">

                    <!-- Exemplo de itens (substituir com o foreach real em breve) -->
                    @for (int i = 0; i < 5; i++)
                    {
                        <div class="itensDados">
                            <p class="nome">Produto tal</p>
                            <p class="quantidade">Quantidade: XX</p>
                            <p class="subtotal">Subtotal: R$ XXXX.xx</p>
                        </div>
                    }

                </div>

                <h2 class="valor">Valor total: R$ XXXX.xx</h2>

            </div>
        </div>
    </div>

    <!-- Editar Conta -->
    <div class="editarConta">
        <div class="tituloBar">
            <h1>Editar Conta</h1>
            <img src="~/imgs/icones/seta-cima.svg" alt="Toggle" class="toggle-editar">
        </div>

        <div class="conteudoEditar">

            <p>Seus dados</p>

            <div class="seusDadosCampo">

                <div class="colunas">

                    <div class="coluna1">
                        <input type="text" placeholder="Nome do usuário" />
                        <input type="text" placeholder="Email do usuário" />
                        <input type="password" placeholder="Senha do usuário" />
                    </div>

                    <div class="coluna2">
                        <input type="text" placeholder="Digite seu endereço" />
                        <input type="number" maxlength="11" placeholder="CPF do usuário" />
                        <input type="tel" placeholder="Telefone do usuário" />
                    </div>

                    <div class="coluna3">
                        <p>Modifique apenas as informações que deseja alterar!</p>
                    </div>

                </div>

                <div class="botoes">
                    <button>Cancelar</button>
                    <button>Alterar</button>
                </div>

            </div>

        </div>
    </div>

    <!-- Talvez você goste -->
    <div class="talvezVoceGoste">
        <p class="talvezVoceGosteP">Talvez você goste</p>

        <div class="produtos">

            @if (Model != null && Model.Any())
            {
                foreach (var produto in Model.OrderBy(x => Guid.NewGuid()).Take(4))
                {
                    <div class="exibicaoCard" data-avaliacao="@produto.Avaliacao.ToString("F1", System.Globalization.CultureInfo.InvariantCulture)">
                        <img src="@produto.UrlImagens[0]" class="exibicaoCardimg" />

                        <p class="cardNome">
                            @(produto.NomeProduto.Length > 20 ? produto.NomeProduto.Substring(0, 20) + "..." : produto.NomeProduto)
                        </p>

                        <div class="cardNotas">
                            <div class="rating-container">
                                <span class="star"></span>
                                <span class="star"></span>
                                <span class="star"></span>
                                <span class="star"></span>
                                <span class="star"></span>
                                <p class="cardNotasNota"><span>@produto.Avaliacao</span>/5</p>
                            </div>

                            <div class="cardPreco">
                                <strong>R$ @produto.Preco</strong>
                            </div>
                        </div>

                    </div>
                }
            }
            else
            {
                <p>Nenhum produto encontrado.</p>
            }

        </div>
    </div>

    @Html.Partial("_FooterSlim")

    <!-- Script: Toggle de Compras -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {

            const toggleCompras = document.querySelector(".toggle-compras");
            const cards = document.querySelector(".cardsDados");
            const dados = document.querySelector(".dadosDaCompra");

            let aberto = true;

            toggleCompras.addEventListener("click", () => {

                if (aberto) {
                    cards.style.maxHeight = "0";
                    cards.style.opacity = "0";
                    cards.style.padding = "0";
                    dados.style.maxHeight = "0";
                    dados.style.opacity = "0";
                    dados.style.padding = "0";
                    toggleCompras.style.transform = "rotate(180deg)";
                } else {
                    cards.style.maxHeight = "700px";
                    cards.style.opacity = "1";
                    cards.style.padding = "16px 0";
                    dados.style.maxHeight = "800px";
                    dados.style.opacity = "1";
                    dados.style.padding = "16px 0";
                    toggleCompras.style.transform = "rotate(0deg)";
                }

                aberto = !aberto;
            });
        });
    </script>

    <!-- Script: Toggle Editar Conta -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {

            const toggleEditar = document.querySelector(".toggle-editar");
            const conteudo = document.querySelector(".conteudoEditar");

            let aberto = false;

            toggleEditar.addEventListener("click", () => {

                if (aberto) {
                    conteudo.style.maxHeight = "0";
                    conteudo.style.opacity = "0";
                    conteudo.style.padding = "0";
                    toggleEditar.style.transform = "rotate(180deg)";
                } else {
                    conteudo.style.maxHeight = "800px";
                    conteudo.style.opacity = "1";
                    conteudo.style.padding = "16px 0";
                    toggleEditar.style.transform = "rotate(0deg)";
                }

                aberto = !aberto;
            });
        });
    </script>

    <!-- Script: Estrelas -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {

            const cards = document.querySelectorAll(".exibicaoCard");

            cards.forEach(card => {
                const rating = parseFloat(card.dataset.avaliacao.replace(",", ".")) || 0;
                const stars = card.querySelectorAll(".star");

                stars.forEach((star, index) => {
                    const value = index + 1;

                    star.classList.remove("filled", "half");

                    if (rating >= value) star.classList.add("filled");
                    else if (rating >= value - .5) star.classList.add("half");
                });
            });
        });
    </script>

</body>
</html>
